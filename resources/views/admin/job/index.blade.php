@extends('layouts.admin-dashboard')

@section('breadcrumbs')

    <section class="content-header">
        <h1>
            Current joblist
            <a class="btn btn-primary pull-right" href="{{ route("admin.job.clear") }}">
                <i class="fa fa-remove"></i> Clear all
            </a>
        </h1>


    </section>

@endsection

@section('content')
    <div class="row">
        <div class="col-xs-12">

            @if(config('queue.default') != "database")
                <div class="alert alert-warning"><i class="fa fa-warning"></i> You are not using database as queue
                    driver, so this area will not be used!
                </div>
            @endif

            <div class="box">
                <!-- /.box-header -->
                <div class="box-body table-responsive no-padding" style="overflow: visible;">

                    <table class="table table-hover">
                        <thead>
                        <tr>
                            <th>#</th>
                            <th>Queue</th>
                            <th>Payload</th>
                            <th>Attempts</th>
                            <th></th>
                            <th></th>
                        </tr>
                        </thead>

                        <tbody>
                        @foreach($jobs as $job)
                            <tr class="job-{{ $job->id }}">
                                <td>
                                    {{ $job->id }}
                                </td>

                                <td>
                                    {{ $job->queue }}
                                </td>

                                <td>
                                    {{ @json_decode($job->payload)->displayName }}
                                </td>

                                <td>
                                    {{ $job->attempts }}
                                </td>

                                <td>
                                    {{ $job->created_at }}
                                </td>

                                <td>
                                    <a class="destroy-job pull-right" data-id="{{ $job->id }}" href="{{ route('admin.job.destroy',$job) }}">
                                        <span class="label label-danger">Delete</span>
                                    </a>
                                </td>

                            </tr>
                        @endforeach
                        </tbody>
                    </table>
                </div>

                <div class="box-footer">
                    {{ $jobs->appends(Input::except('page'))->links() }}
                </div>
            </div>

            <!-- /.box -->
        </div>

    </div>
@endsection

@push('script-files')
    <script src="{{ mix('js/admin/modules/job.index.js') }}"></script>
@endpush

@push('modals')
    <div id="infobox">
        <div class="alert alert-info">
            <span></span>
        </div>
    </div>
@endpush